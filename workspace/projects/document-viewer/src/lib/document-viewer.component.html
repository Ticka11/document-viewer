<div
  class="viewer-container"
  [ngStyle]="{ 'justify-content': totalPages > 1 ? 'space-between' : 'center' }"
  id="viewer-container"
>
  <div id="info-box">
    <div class="col-12 col-sm-12 p-0">
      <ng-template #orgDocInfo>
        <div class="sub-doc-info p-0">
          <div *ngIf="collapsStatus">
            {{ singleDocument?.file?.originalName }}
          </div>
          <span class="file-type-sub file-type">
            <span
              class="kat-sub-sent"
              *ngIf="
                singleDocument?.file?.sent && docModel.isModelContainerRjesenje
              "
            ></span>
            <span
              class="kat-sub-not-sent"
              *ngIf="
                !singleDocument?.file?.sent && docModel.isModelContainerRjesenje
              "
            ></span>
            <span class="sub-date">{{
              singleDocument?.file?.createdAt | date : "dd/MM/yy"
            }}</span>
          </span>
          <div class="sub-dco-type">
            {{ singleDocument?.file.type }}
          </div>
          <div class="mt-1">
            <div *ngFor="let sentance of singleDocument.file.toFix">
              <span class="mt-2"> {{ sentance }} </span>
            </div>
          </div>
        </div>
      </ng-template>
      <!-- merged docs -->

      <div
        class="model-info p-0 parent-ellipsis d-contents"
        *ngIf="singleDocument.originalMergedDocs"
      >
        <div ngbDropdown class="d-inline-block">
          <button
            type="button"
            class="btn btn-transparent border-0 btn-classic merged-btn"
            id="dropdownBasic1"
            ngbDropdownToggle
          >
            <span
              *ngIf="
                selectedFile !== undefined && checkSelectedDocs() === false
              "
              class="document-name"
              [ngClass]="
                selectedFile.file.filterValue ||
                activeFileId === selectedFile.file._id
                  ? 'active-filter'
                  : 'inactive-filter'
              "
            >
              <div
                class="underlined"
                [ngStyle]="{
                  'border-bottom':
                    selectedFile.colorValue === openedDocColor
                      ? '4px solid ' + selectedFile.colorValue
                      : '4px solid ' + selectedFile.colorValue + '54'
                }"
              >
                {{ selectedFile?.file?.originalName | stringEllipsis : 15 }}
              </div>
            </span>

            <span
              *ngIf="
                checkSelectedDocs() === false && selectedFile === undefined
              "
              >Merged documents</span
            >
            <span *ngIf="checkSelectedDocs() === true"
              >Multiple selected documents</span
            >
          </button>
          <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
            <button
              ngbDropdownItem
              class="px-1"
              [ngbTooltip]="singleDocInfo"
              *ngFor="
                let doc of singleDocument.originalMergedDocs;
                last as isLast
              "
            >
              <input
                class="form-check-input inp-cbx"
                type="checkbox"
                name="document"
                [id]="'defaultCheck' + doc.file._id"
                [(ngModel)]="doc.file.filterValue"
                (ngModelChange)="filterPattern($event, doc)"
              />
              <label
                class="w-100 cbx m-0 d-flex align-items-center"
                [ngClass]="
                  doc.file.filterValue || activeFileId === doc.file._id
                    ? 'active-filter'
                    : 'inactive-filter'
                "
                [for]="'defaultCheck' + doc.file._id"
                ><span class="mx-2">
                  <svg width="12px" height="10px">
                    <use xlink:href="#check"></use></svg
                ></span>
                <span class="document-name">
                  <div
                    class="underlined"
                    [ngStyle]="{
                      'border-bottom':
                        doc.colorValue === openedDocColor
                          ? '4px solid ' + doc.colorValue
                          : '4px solid ' + doc.colorValue + '54'
                    }"
                  >
                    {{ doc?.file?.originalName | stringEllipsis : 20 }}
                  </div>
                </span>
              </label>
              <svg class="inline-svg mr-1">
                <symbol id="check" viewbox="0 0 12 10">
                  <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                </symbol>
              </svg>
              <!-- tooltip template -->
              <ng-template #singleDocInfo>
                <div class="sub-doc-info">
                  <div *ngIf="collapsStatus">
                    {{ doc?.file?.originalName }}
                  </div>
                  <span class="file-type-sub file-type">
                    <span
                      class="kat-sub-sent"
                      *ngIf="
                        doc?.file?.sent && docModel.isModelContainerRjesenje
                      "
                    ></span>
                    <span
                      class="kat-sub-not-sent"
                      *ngIf="
                        !doc?.file?.sent && docModel.isModelContainerRjesenje
                      "
                    ></span>
                    <span class="sub-date">{{
                      doc?.file?.createdAt | date : "dd/MM/yy"
                    }}</span>
                  </span>
                  <div class="sub-dco-type">
                    {{ doc?.file.type }}
                  </div>
                </div>
              </ng-template>
            </button>
          </div>
        </div>
      </div>
      <span
        class="d-inline-flex mx-2 w-50px"
        *ngIf="
          singleDocument?.file?.existingAnalysedFilesGroupsIDs &&
          singleDocument?.file.existingAnalysedFilesGroupsIDs.length > 0
        "
      >
        <ul
          *ngIf="singleDocument?.file.existingAnalysedFilesGroupsIDs"
          class="list-of-existing-analysed"
        >
          <li
            *ngFor="
              let item of singleDocument?.file.existingAnalysedFilesGroupsIDs;
              let i = index
            "
            (click)="redirectTo(item._id)"
          >
            <a
              role="button"
              ngbTooltip="Go to previous file"
              class="text-small btn archive-btn btn-sm btn-circle bg-light"
              *ngIf="i < 2"
            >
              <span class="archive-icon" [id]="item">
                <svg
                  version="1.0"
                  xmlns="http://www.w3.org/2000/svg"
                  width="512.000000pt"
                  height="512.000000pt"
                  viewBox="0 0 512.000000 512.000000"
                  preserveAspectRatio="xMidYMid meet"
                >
                  <g
                    transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
                    fill="#000000"
                    stroke="none"
                  >
                    <path
                      d="M1266 4949 c-62 -15 -153 -68 -197 -116 -22 -24 -55 -74 -72 -111
l-32 -67 -3 -806 -3 -807 -167 -3 -168 -4 -76 -37 c-91 -45 -147 -103 -191
-196 l-32 -67 0 -1136 0 -1135 37 -76 c45 -91 103 -147 196 -191 l67 -32 1695
0 1695 0 67 32 c37 17 87 50 112 73 55 51 111 158 121 232 4 29 115 539 247
1133 261 1178 253 1127 203 1225 -36 71 -67 103 -137 141 l-63 34 -362 3 -363
3 0 617 0 617 -343 342 -342 343 -925 -1 c-518 -1 -942 -5 -964 -10z m1775
-317 l4 -168 37 -76 c45 -91 103 -147 196 -191 66 -31 71 -32 235 -35 l167 -4
0 -799 0 -799 -862 0 -862 0 -241 240 -241 240 -177 0 -177 0 0 776 c0 581 3
787 12 818 15 51 99 137 148 153 24 8 299 11 896 12 l862 1 3 -168z m447 -310
c-105 -4 -153 12 -213 72 -60 61 -75 102 -75 212 l0 79 180 -180 180 -180 -72
-3z m-1843 -1682 l241 -240 1033 0 c782 0 1044 -3 1075 -12 55 -16 138 -99
154 -154 17 -59 17 -1689 0 -1748 -16 -55 -99 -138 -154 -154 -60 -17 -3288
-17 -3348 0 -55 16 -138 99 -154 154 -17 60 -17 2168 0 2228 15 51 99 137 148
153 23 7 164 11 400 12 l364 1 241 -240z m2899 226 c39 -16 84 -71 91 -112 3
-18 -56 -301 -154 -739 l-159 -710 -3 476 -4 475 -37 76 c-70 140 -187 216
-349 226 l-89 5 0 158 0 159 335 0 c264 0 343 -3 369 -14z"
                    />
                    <path
                      d="M1440 4400 l0 -80 720 0 720 0 0 80 0 80 -720 0 -720 0 0 -80z"
                    />
                    <path
                      d="M1440 4080 l0 -80 720 0 720 0 0 80 0 80 -720 0 -720 0 0 -80z"
                    />
                    <path
                      d="M1440 3760 l0 -80 960 0 960 0 0 80 0 80 -960 0 -960 0 0 -80z"
                    />
                    <path
                      d="M1440 3440 l0 -80 960 0 960 0 0 80 0 80 -960 0 -960 0 0 -80z"
                    />
                  </g>
                </svg>
              </span>
            </a>
          </li>
        </ul>
      </span>
      <!--  triggers="mouseenter:mouseleave" -->
      <button
        [ngbPopover]="popContent2"
        [popoverTitle]="'Archived documents'"
        popoverClass="archived-popover-container"
        *ngIf="
          singleDocument?.file?.existingAnalysedFilesGroupsIDs &&
          singleDocument?.file.existingAnalysedFilesGroupsIDs.length > 2
        "
        class="archived-button hover-button"
        (click)="onClickArchived($event)"
      >
        <span class="typcn typcn-plus" style="font-size: 8px"></span>
        <span>{{
          singleDocument?.file.existingAnalysedFilesGroupsIDs.length - 2
        }}</span>
      </button>
      <ng-template #popContent2 class="model-group-file">
        <div
          *ngFor="
            let groupFile of singleDocument?.file
              ?.existingAnalysedFilesGroupsIDs;
            let i = index
          "
        >
          <p
            *ngIf="i > 1"
            role="button"
            class="text-small prev-file mb-2"
            (click)="redirectTo(groupFile._id)"
          >
            {{ groupFile.externalData.contractId }}

            |
            <small
              ><i class="bi bi-calendar"></i>
              {{ groupFile.createdAt | date }}</small
            >
          </p>
        </div>

        <!-- <span *ngIf="groupFile !== undefined"> {{ groupFile }}</span> -->
      </ng-template>
      <!-- end of merged  -->
      <div class="model-info p-0 parent-ellipsis" [ngbTooltip]="orgDocInfo">
        <p
          *ngIf="!singleDocument.mergedDocs"
          [ngClass]="{
            'red-flag': documentConfig?.flag == 'red',
            'green-flag': documentConfig?.flag == 'green'
          }"
          class="traning-model-name text-ellipsis"
          (click)="collapsSubDocs()"
        >
          {{ singleDocument?.file?.originalName }}
        </p>
      </div>
      <div class="d-flex justify-content-center" *ngIf="docModel">
        <span
          *ngIf="
            singleDocument.file?.matchingDocs?.length > 0 && !collapsStatus
          "
          class="sub-doc-num"
          >DOCS: {{ singleDocument.file?.matchingDocs?.length }}</span
        >
        <div
          *ngFor="
            let matchingDoc of singleDocument.file?.matchingDocs;
            let i = index
          "
          class="parent-ellipsis"
        >
          <div
            *ngIf="!singleDocument.mergedDocs && matchingDoc.collaps"
            [@inOutAnimation]
            class="collaps-box"
          >
            <div id="pointer"></div>
            <div class="sub-doc text-ellipsis" [ngbTooltip]="redFlagTemplate">
              <ng-template #redFlagTemplate>
                <div class="sub-doc-info">
                  <div *ngIf="matchingDoc.collaps">
                    {{ matchingDoc.originalName }}
                  </div>
                  <span class="file-type-sub file-type">
                    <span
                      class="kat-sub-sent"
                      *ngIf="
                        matchingDoc.jobStatus == 'completed' &&
                        matchingDoc.sent &&
                        docModel.isModelContainerRjesenje
                      "
                    ></span>
                    <span
                      class="kat-sub-not-sent"
                      *ngIf="
                        matchingDoc.jobStatus == 'completed' &&
                        !matchingDoc.sent &&
                        docModel.isModelContainerRjesenje
                      "
                    ></span>
                    <span class="sub-date">{{
                      matchingDoc.createdAt | date : "dd/MM/yy"
                    }}</span>
                  </span>
                  <div class="sub-dco-type">
                    {{ matchingDoc?.type }}
                  </div>
                </div>
              </ng-template>
              <a
                (click)="openMatchingDoc(matchingDoc)"
                [ngClass]="{
                  'file-not-ready':
                    (matchingDoc.hasOwnProperty('confidenceStatus') &&
                      matchingDoc?.confidenceStatus === false) ||
                    matchingDoc.checked,
                  'file-ready':
                    (matchingDoc.hasOwnProperty('confidenceStatus') &&
                      matchingDoc?.confidenceStatus === false) ||
                    matchingDoc.checked
                }"
                class="sub-doc-name"
                >{{ matchingDoc.originalName }}</a
              >
            </div>
          </div>
        </div>
      </div>
      <div
        class="align-items-center info-container"
        *ngIf="docModel"
        [ngClass]="{
          'mt-3': singleDocument?.file?.existingAnalysedFilesGroupsIDs
        }"
      >
        <p>
          <span
            [ngClass]="
              this.singleDocument.prev?.fileName ? '' : 'disable-next-prev'
            "
            class="doc-prev typcn typcn-chevron-left"
            (click)="
              !this.singleDocument.prev?.fileName ? null : changeDoc(false)
            "
          ></span>
          MODEL: {{ docModel.modelName }} - {{ docModel.modelVersion }} @
          {{ singleDocument.file.createdAt | date : "MMM d, y HH:mm" }}
          <span
            [ngClass]="
              this.singleDocument.next?.fileName ? '' : 'disable-next-prev'
            "
            class="doc-next typcn typcn-chevron-right"
            (click)="
              !this.singleDocument.next?.fileName ? null : changeDoc(true)
            "
          ></span>
        </p>
      </div>
    </div>
  </div>

  <div id="search-box">
    <lib-document-actions
      [documentConfig]="documentConfig"
      [document]="document"
      class="document-actions-container"
      [documentActionsSrc]="documentActionsSrc"
      id="viewer"
      [isOpenVar]="isOpenVar"
      (isOpen)="isOpenEmmit($event)"
    ></lib-document-actions>
    <lib-search-modal
      (pageSearch)="emitPageSearch($event)"
      class="search-component"
      (searchTextInDoc)="emitSearchedText($event)"
    >
    </lib-search-modal>
    <lib-document-actions-left
      [inProjects]="inProjects"
      (downloadExcelEvent)="downloadExcel($event)"
      [editable]="documentConfig?.editable"
      (downloadDocument)="downloadDocument($event)"
      (downloadParagraphs)="downloadParagraphs($event)"
      class="document-actions-left-container"
      id="viewer"
      [documentActionsSrc]="documentActionsSrc"
      [document]="document"
      [singleDocument]="singleDocument"
      [docModel]="docModel"
      [params]="params"
      (exportMonthlyStat)="exportMonthlyStatEventEmmiter($event)"
    ></lib-document-actions-left>
  </div>

  <div class="d-flex align-items-center flex-column" id="doc-box">
    <lib-document
      (naturalDimensions)="emitImgNaturalDimension($event)"
      [documentConfig]="documentConfig"
      #document
      (triggerTextLayer)="triggerTextLayerCreation($event)"
      (pageSearch)="emitPageSearch($event)"
      class="document-viewer-container"
    ></lib-document>
  </div>

  <lib-page-navigation
    [documentActionsSrc]="documentActionsSrc"
    [triggeredModalIsOpen]="triggeredModalIsOpen"
    [singleDocument]="singleDocument"
    [reorderFinished]="reorderFinished"
    (downloadDocumentEvent)="downloadDocument($event)"
    [documentsList]="
      singleDocument.originalMergedDocs
        ? singleDocument.originalMergedDocs
        : [singleDocument]
    "
    (triggerTextLayer)="triggerTextLayerCreation($event)"
    (reorderDocumentEvent)="triggerReorderDocument($event)"
    (separateDocumentEvent)="triggerSeparateDocument($event)"
    (triggerPagesReorder)="triggerPagesReorder($event)"
    (triggerSplitDocument)="triggerSplitDocument($event)"
    (openTriggeredEmittrt)="openTriggered($event)"
    class="document-page-navigation-container"
  ></lib-page-navigation>
</div>
<lib-info-modal></lib-info-modal>
